### NOTICE: This file is auto-generated by ansible, DO NOT edit this file manually!


#peers mypeers
#        peer cufm01 10.2.2.143:8001
#        peer cufm02 10.2.2.144:8001


#listen stats
#        bind 10.2.2.143:8000
#        stats enable
#        stats uri     /stats
#        stats refresh 10s
#        stats auth admin:ubilink@Ha@2024
#        stats hide-version

frontend frontend-https-to-http
    bind :443 ssl crt /etc/haproxy/conf.d/comb.pem
    log global
    mode http
    option httplog
    option forwardfor

    http-request capture req.hdr(Host) len 30
    log-format "%ci:%cp [%tr] %ft %b/%s %TR/%Tw/%Tc/%Tr/%Ta %ST %B %CC %CS %tsc %ac/%fc/%bc/%sc/%rc %sq/%bq %hr %hs %{+Q}r fqdn:\ %[capture.req.hdr(0)]\ %hr\ %hrl\ %hs\ %hsl"

    acl userportal hdr(host) -i cloudinfra-portal.ubilink.ai
    acl adminportal hdr(host) -i cloudinfra-mgmt.ubilink.ai
    acl cloudstorage hdr(host) -i cloudinfra-cloudstorage.ubilink.ai
    acl systemkong hdr(host) -i cloudinfra-api.ubilink.ai
    acl harbor hdr(host) -i cloudinfra-registry.ubilink.ai
    acl harbor-dot hdr(host) -i cloudinfra-registry.ubilink.ai.
    acl services hdr(host) -i cloudinfra-services.ubilink.ai
    acl codimd hdr(host) -i cloudinfra-docs.ubilink.ai
    acl grafana hdr(host) -i cloudinfra-grafana.ubilink.ai
    acl kibana hdr(host) -i cloudinfra-kibana.ubilink.ai
    acl billing hdr(host) -i billing.ubilink.ai

    acl is_root path /

    redirect prefix https://cloudinfra-docs.ubilink.ai/s/user-guide if codimd is_root

    use_backend codimd-backend if codimd
    use_backend user-portal if userportal
    use_backend admin-portal if adminportal
    use_backend cloud-storage-backend if cloudstorage
    use_backend systemkong-backend if systemkong
    use_backend harbor-backend if harbor
    use_backend harbor-backend if harbor-dot
    use_backend userkong-backend if services
    use_backend grafana-backend if grafana
    use_backend kibana-backend if kibana
    use_backend billing-backend if billing
    
    default_backend no-match

backend codimd-backend
    mode http
    balance source
    server codimd-backend-server-01 10.2.2.163:31012 check

backend user-portal
    mode http
    balance source
    server user-portal-server-01 10.2.2.163:31010 check

backend admin-portal
    mode http
    balance source
    server admin-portal-server-01 10.2.2.163:31011 check

backend cloud-storage-backend
    mode http
    balance source
    server cloud-storage-backend-01 10.2.2.163:31000 check

backend systemkong-backend
    mode http
    balance source
    server systemkong-server-01 10.2.2.163:31382 check

backend harbor-backend
    mode http
    balance source
    server harbor-backend-server-01 10.2.2.163:31352 check ssl verify none

backend userkong-backend
    mode http
    balance source
    server userkong-server-01 10.2.2.163:31013 check

backend ml-flow-backend
    mode http
    balance source
    server ml-flow-server-01 10.2.2.163:31382 check

backend grafana-backend
    mode http
    balance source
    server grafana-server-01 10.2.2.163:31487 check

backend kibana-backend
    mode http
    balance source
    server kibana-server-01 10.2.2.163:31487 check

backend no-match
    mode http
    http-request deny deny_status 404
